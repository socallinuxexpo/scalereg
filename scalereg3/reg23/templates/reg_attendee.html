{% extends "reg_base.html" %}
{% load i18n %}
{% load reg23_filters %}
{% block content %}
<div id="content-main">
<style type="text/css">
.reg23_form_error { color: #FF0000; font-weight: bold }
.reg23_label { font-weight: normal }
.reg23_title_org_dialog {
    border-color: #000;
    border-width: 3px;
    padding: 16px;
}
b { font-weight: bold }
</style>

{% if ticket and total %}
    {% if promo %}
    <p>
    You are using promo code <b>{{ promo }}</b>.
    </p>
    {% endif %}

    <p>
    Your {{ ticket.description }} costs {{ ticket.price|money }}.
    </p>

    {% if items %}
    <p>
    You added the following additional items:
    </p>

    {% for item in items %}
    <p>
        * {{ item.description }}: {{ item.price|money }}
    </p>
    {% endfor %}
    {% endif %}

    {% if offset_item %}
    <p>
    You received the following credits:
    </p>

    <p>
    * {{ offset_item.description }} waives the ticket price of
      {{ ticket.price|money }}.
    </p>
    {% endif %}

    <p>
    Your total is {{ total|money }}.
    </p>

    <p>
    We now need the following information from you. The fields in <b>bold</b>
    are required.
    </p>

    <form id="form" method="post" action=".">

    <input type="hidden" name="promo" value="{{ promo }}" />
    <input type="hidden" name="ticket" value="{{ ticket.name }}" />
    {% for item in items %}
        <input type="hidden" name="item{{ forloop.counter0 }}"
               value="{{ item.name }}" />
    {% endfor %}

    <p>
    <table>
    {% if form.salutation.errors %}
    <tr>
        <td colspan="2" class="reg23_form_error">
            {{ form.salutation.errors|join:", " }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td>
            <label class="reg23_label" for="id_salutation">Salutation:</label>
        </td>
        <td>{{ form.salutation }}</td>
    </tr>
    {% if form.first_name.errors %}
    <tr>
        <td colspan="2" class="reg23_form_error">
            {{ form.first_name.errors|join:", " }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td>
            <label class="reg23_label" for="id_first_name">
                <b>First Name:</b>
            </label>
        </td>
        <td>{{ form.first_name }}</td>
    </tr>
    {% if form.last_name.errors %}
    <tr>
        <td colspan="2" class="reg23_form_error">
            {{ form.last_name.errors|join:", " }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td>
            <label class="reg23_label" for="id_last_name">
                <b>Last Name:</b>
            </label>
        </td>
        <td>{{ form.last_name }}</td>
    </tr>
    {% if form.title.errors %}
    <tr>
        <td colspan="2" class="reg23_form_error">
            {{ form.title.errors|join:", " }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td><label class="reg23_label" for="id_title">Title:</label></td>
        <td>{{ form.title }}</td>
    </tr>
    {% if form.org.errors %}
    <tr>
        <td colspan="2" class="reg23_form_error">
            {{ form.org.errors|join:", " }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td><label class="reg23_label" for="id_org">Organization:</label></td>
        <td>{{ form.org }}</td>
    </tr>
    {% if form.zip_code.errors %}
    <tr>
        <td colspan="2" class="reg23_form_error">
            {{ form.zip_code.errors|join:", " }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td>
            <label class="reg23_label" for="id_zip_code">
                <b>Zip/Postal Code:</b>
            </label>
        </td>
        <td>{{ form.zip_code }}</td>
    </tr>
    {% if form.email.errors %}
    <tr>
        <td colspan="2" class="reg23_form_error">
            {{ form.email.errors|join:", " }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td><label class="reg23_label" for="id_email"><b>Email:</b></label></td>
        <td>{{ form.email }}</td>
    </tr>
    {% if form.phone.errors %}
    <tr>
        <td colspan="2" class="reg23_form_error">
            {{ form.phone.errors|join:", " }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td><label class="reg23_label" for="id_phone">Phone:</label></td>
        <td>{{ form.phone }}</td>
    </tr>
    {% if form.can_email.errors %}
    <tr>
        <td colspan="2" class="reg23_form_error">
            {{ form.can_email.errors|join:", " }}
        </td>
    </tr>
    {% endif %}
    <tr>
        <td valign="top">
            <label class="reg23_label" for="id_can_email">
                <b>Add me to the announcement mailing list:</b>
            </label>
        </td>
        <td>
            <table id="id_can_email">
                {% for radio in form.can_email %}
                <tr>
                    <td valign="top">{{ radio.tag }}</td>
                    <td>
                        <label for="{{ radio.id_for_label }}">
                        {% if radio.choice_label == "Logistics Only" %}
                            Logistics Only - I only wish to receive important
                            notifications about my tickets to this year's event.
                            Do not contact me about future events.
                        {% elif radio.choice_label == "Announcements" %}
                            Include me on the SCALE announcement mailing list
                            so I stay updated on future SCALE events.
                        {% elif radio.choice_label == "Special Offers" %}
                            Include me in the conference Opt-In list so I can
                            receive one time messages and special offers from
                            SCALE sponsors after the event. My personal
                            information will not be shared with third parties
                            unless I present my badge to them for scanning at
                            the conference.
                        {% else %}
                            {{ radio.choice_label }}
                        {% endif %}
                        </label>
                    </td>
                </tr>
                {% endfor %}
            </table>
       </td>
    </tr>
    </table>
    </p>

    {% if questions %}
    <p>
    Survey Questions:
    </p>

    {% if form.answers.errors %}
    <p>
    <span class="reg6_form_error">{{ form.answers.errors|join:", " }}</span>
    </p>
    {% endif %}

    <p>
    <div>
    {% for question in questions %}
        <label>
        <div>{{ question.text }}</div>
        <div>
        {% if question.is_text_question %}
            <input type="text" name="question{{ question.id }}"
            {% if question.max_length %}
                   maxlength="{{ question.max_length }}"
            {% endif %}
            />
        {% else %}
            <select name="question{{ question.id }}" size="1">
                <option value="" selected="selected"></option>
                {% for answer in question.get_list_answers %}
                <option value="{{ answer.id }}">{{ answer.text }}</option>
                {% endfor %}
            </select>
        {% endif %}
        </div>
        </label>
    {% endfor %}
    </div>
    </p>
    {% endif %}

    <p>
    <input type="submit" value="Continue" />
    </p>
    {% csrf_token %}
    </form>

    <dialog id="title_org_dialog" class="reg23_title_org_dialog">
        <p>
            Before continuing, could we trouble you for your employer and
            title?<br />
            This helps us immensely as we tailor conference content for future
            events.
        </p>
        <form>
            <button value="cancel" formmethod="dialog">Go Back</button>
            <button value="continue" formmethod="dialog">Continue</button>
        </form>
    </dialog>

    <form method="post" action="../">
    <p>
    <input type="hidden" name="promo" value="{{ promo }}" />
    <input type="submit" value="Start Over" />
    </p>
    {% csrf_token %}
    </form>

    <script>
    const form = document.getElementById("form");
    const dialog = document.getElementById("title_org_dialog");

    form.addEventListener('submit', () => {
      if (!document.getElementById("id_title").value.length &&
          !document.getElementById("id_org").value.length) {
        event.preventDefault();
        dialog.showModal();
      }
    });

    dialog.addEventListener("close", () => {
      if (dialog.returnValue === "continue") {
        form.submit();
      }
    });
    </script>
{% else %}
Registration is closed.
{% endif %}
</div>
{% endblock %}
